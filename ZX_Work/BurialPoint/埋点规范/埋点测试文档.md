# 埋点测试规范

## 1. **测试前的准备**

- **定义测试目标**：明确需要验证的埋点的属性 
    - 埋点ID：埋点的唯一ID
    - 需求类型：新增埋点、修改埋点、下线埋点
    - 所属平台：app、移动端
    - 埋点平台：魔方埋点、天鹅埋点、三方页面埋点
    - 埋点技术位置：客户端埋点、服务端埋点
    - 埋点类型：页面埋点、事件埋点
    - 返回类型：实时返回、异步返回
    - 返回数据类型：string, int, float等
    - 埋点热度：高、中、低

- **文档准备**：确保所有埋点的详细信息都有文档记录，包括埋点触发条件、预期收集的数据类型及格式。
    - 测试相关信息
      - 测试时间
      - 测试人
    - 需求记录：需求prd，邮件记录等。
    - 触发条件：可根据该描述触发埋点或重现问题。包含pageID，按钮位置，操作方法等。
    - 预期结果：测试后预期在日志中找到的结果，如预期json，预期的数据类型等
    - 测试记录：保存测试步骤，并标注点击的位置、ID、实参等。如bannerID，eventID，输入参数等
    - 服务端返回日志：保存测试埋点后服务端返回的raw日志
    - 数据库查询结果：根据埋点属性，在离线库或实时库中查找埋点落表记录

## 2. **测试环境设置**

- **环境隔离**：
    - 确保测试机或地址为测试环境，以免影响生产环境
- **测试工具和资源**：
    - 确保有适当的工具和资源进行数据收集和分析
    - 测试工具：模拟器，录屏软件，日志解析包fastjson等

## 3. **测试执行**

- **模拟用户行为**：
    - 按照文档中触发条件中步骤进行测试，模拟待测试埋点是否成功触发，是否有报错抛出等异常
    - 服务端埋点可通过脚本触发，进行批量测试
- **数据收集与验证**：
    - 模拟器中收集实时日志，根据日志初步验证埋点的准确性，完整性和及时性。
- **边界条件测试**：
    - 对该埋点进行包括对不常见或异常用户行为的测试，确保埋点在这些情况下也能正确工作。

## 4. **问题定位与修复**

- **数据异常分析**：
    - 如对于收集到的数据异常，按照该埋点的数据链路，从生产方到消费方的方向定位问题，并分析原因。
- **修复与再测试**：
    - 对埋点代码进行修复，并进行再次测试以验证问题解决。

## 5. **性能测试**

- **影响评估**：
    - 评估埋点对应用性能的影响，实时埋点的返回体不应过大，确保不会显著影响用户体验，保证响应时间在100ms内
- **优化**：
    - 对于上报频次较高的埋点，如影响性能，可在客户端cache中保存后批量上报

## 6. **上线前的最终验证**

- **全面回归测试**：
    - 在预上线环境中进行全面的回归测试，确保所有埋点按预期工作。
- **验证数据上报**：
    - 确认数据上报到数据接收平台，格式和内容符合预期。

# 埋点测试checklist

1. **准备阶段**
    - [ ] 定义测试目标和范围 
    - [ ] 准备测试文档和工具

2. **测试环境配置**
    - [ ] 设置和配置测试环境
    - [ ] 确保测试资源可用

3. **执行测试**
    - [ ] 模拟用户行为触发埋点
    - [ ] 收集并验证埋点数据
    - [ ] 执行边界条件测试

4. **问题定位与修复**
    - [ ] 分析数据异常
    - [ ] 修复问题并再次测试

5. **性能评估**
    - [ ] 进行性能测试
    - [ ] 优化埋点实现

6. **最终验证**
    - [ ] 完成全面回归测试
    - [ ] 验证数据上报完整性和准确性

7. **文档更新和团队反馈**
    - [ ] 更新测试文档
    - [ ] 向团队提供反馈和建议

``` mermaid
graph LR
    A[准备阶段] --> B[测试环境配置]
    B --> C[执行测试]
    C --> D[问题定位与修复]
    D --> C
    D --> E[性能评估]
    E --> C
    E --> F[最终验证]
    F --> G[文档更新和团队反馈]
```