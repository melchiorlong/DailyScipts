# 埋点测试规范 V1.1

## 埋点是什么
客户端埋点是一种常见的数据收集技术，主要用于追踪和收集用户在网页或应用上的行为数据。其主要意义和作用包括：
1. 用户行为分析：通过收集用户的点击、浏览、停留时间、页面跳转等行为，帮助产品经理和开发者了解用户的使用习惯和偏好，从而对产品进行优化和改进。
2. 性能监测：埋点可以用来监测应用的性能，如页面加载速度、响应时间等，及时发现和解决性能瓶颈，提升用户体验。
3. 功能使用率分析：通过分析用户对应用中各项功能的使用频率，可以判断哪些功能受欢迎，哪些不受欢迎，据此调整产品功能布局和开发重点。
4. 转化跟踪：对于电商和营销类网站或应用，通过埋点可以追踪用户的转化路径，如从浏览商品到下单支付的全过程，帮助分析营销活动的效果，优化推广策略。
5. 个性化推荐：收集的用户行为数据可以用于分析用户偏好，为用户提供个性化的内容或商品推荐，提高用户满意度和粘性。
6. 风险控制：在安全领域，通过分析用户行为数据，可以识别异常行为，进行风险控制和欺诈预防。

## 为什么要做埋点测试
埋点测试是确保数据收集准确性和完整性的重要环节，主要用于验证客户端埋点数据的准确收集和上报。进行埋点测试的原因包括：
1. 准确性验证：确保每个埋点收集的数据准确无误，包括用户行为、事件属性、时间戳等信息。错误的数据可能会导致错误的业务决策和分析结论。
2. 完整性检查：验证所有需要追踪的用户行为是否都被正确标记和收集。遗漏的埋点可能会导致数据分析的不完整性，从而影响到产品优化的决策过程。
3. 性能影响评估：评估埋点对应用性能的影响，确保数据收集的过程不会对用户体验产生负面影响，如应用加载速度减慢、响应时间延长等。
4. 数据一致性：在多平台（如移动端和Web端）或多版本的应用中，确保收集到的数据在格式和内容上保持一致，便于进行跨平台的数据分析。
5. 合规性检查：确保数据收集和处理过程遵守相关法律法规和隐私政策，防止隐私泄露和数据安全风险。
6. 改进用户体验：通过分析埋点数据，识别用户使用产品中的痛点和障碍，指导产品改进和优化，提升用户满意度和留存率。

## 1. 测试前的准备

- 定义测试目标：明确需要验证的埋点的属性
    - 埋点ID：埋点的唯一ID
    - 需求类型：新增埋点、修改埋点、下线埋点
    - 所属平台：Web端、移动端
    - 埋点平台：魔方埋点、天鹅埋点、三方页面埋点
    - 埋点技术位置：客户端埋点、服务端埋点
    - 埋点类型：页面埋点、事件埋点
    - 返回类型：实时返回、异步返回
    - 返回数据类型：string, int, float等
    - 埋点热度：高、中、低

- 文档准备：确保所有埋点的详细信息都有文档记录，包括埋点触发条件、预期收集的数据类型及格式。
    - 测试相关信息
        - 测试时间
        - 测试人
    - 需求记录：需求prd，邮件记录等。
    - 触发条件：可根据该描述触发埋点或重现问题。包含pageID，按钮位置，操作方法等。
    - 预期结果：测试后预期在日志中找到的结果，如预期json，预期的数据类型等
    - 测试记录：保存测试步骤，并标注点击的位置、ID、实参等。如bannerID，eventID，输入参数等
    - 服务端返回日志：保存测试埋点后服务端返回的raw日志
    - 数据库查询结果：根据埋点属性，在离线库或实时库中查找埋点落表记录

## 2. 测试环境设置

- 环境隔离：
    - 确保测试机或地址为测试环境，以免影响生产环境

- 测试工具和资源：
    - 确保有适当的工具和资源进行数据收集和分析
    - 测试工具：模拟器，录屏软件，日志解析包 fastjson 等
    - 手机银行设置App和ZX银行测试App
        1. 通过二维码下载手机银行设置App和ZX银行测试App
        2. 申请行内Wi-Fi
        3. 连接行内Wi-Fi，打开手机银行设置App，选择P13内网，点击保存并启动，ZX银行测试App则会被打开

## 3. 测试执行

- 数据收集与验证：
    - 打开ZX银行测试App后，按照触发条件中步骤进行测试，模拟待测试埋点是否成功触发，是否有报错抛出等异常
    - 点击页面侧边【vConsole】按钮查看日志及返回值是否如预期返回
- 边界条件测试：
    - 对该埋点进行包括对不常见或异常用户行为的测试，确保埋点在这些情况下也能正确工作。

## 4. 问题定位与修复

- 数据异常分析：
    - 如对于收集到的数据异常，则应按照该埋点的数据链路，从生产方到消费方的方向，定位问题并分析原因。
- 修复与再测试：
    - 对埋点代码进行修复，并进行再次测试以验证问题解决。

## 5. 性能测试

- 影响评估：
    - 评估埋点对应用性能的影响，实时埋点的返回体不应过大，确保不会显著影响用户体验，保证响应时间在100ms内
- 优化：
    - 对于上报频次较高的埋点，如影响性能，可在客户端cache中保存后批量上报

## 6. 上线前的最终验证

- 全面回归测试：
    - 在预上线环境中进行全面的回归测试，确保所有埋点按预期工作。
- 验证数据上报：
    - 确认数据上报到数据接收平台，格式和内容符合预期。

# 埋点测试 Checklist

``` mermaid
graph LR
    A[准备阶段] --> B[测试环境配置]
    B --> C[执行测试]
    C --> D[问题定位与修复]
    D --> C
    D --> E[性能评估]
    E --> C
    E --> F[最终验证]
    F --> G[文档更新和团队反馈]
```

1. 准备阶段
    - [ ] 定义测试目标和范围
    - [ ] 准备测试文档和工具

2. 测试环境配置
    - [ ] 设置和配置测试环境
    - [ ] 确保测试资源可用

3. 执行测试
    - [ ] 模拟用户行为触发埋点
    - [ ] 收集并验证埋点数据
    - [ ] 执行边界条件测试

4. 问题定位与修复
    - [ ] 分析数据异常
    - [ ] 修复问题并再次测试

5. 性能评估
    - [ ] 进行性能测试
    - [ ] 优化埋点实现

6. 最终验证
    - [ ] 完成全面回归测试
    - [ ] 验证数据上报完整性和准确性

7. 文档更新和团队反馈
    - [ ] 更新测试文档
    - [ ] 向团队提供反馈和建议

